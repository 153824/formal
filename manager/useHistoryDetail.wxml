<!--manager/useHistoryDetail.wxml-->
<!--<follow></follow>-->
<view class="use-history-detail">
    <view class="use-history-head-wrapper">
        <view class="cover">
            <image src="{{ baseInfo.paper.smallImg }}"></image>
        </view>
        <view class="info">
            <view class="title">{{ baseInfo.paper.name }}</view>
            <view class="count">
                <text>发放数量：{{ baseInfo.batchCount }}份</text><text wx:if="{{ status == '3' }}"> ( 已撤回{{ baseInfo.batchCount - baseInfo.finishedCount - baseInfo.receivedCount }}份 )</text>
            </view>
            <view>
                <text class="send-way">发放方式：二维码</text>
                <text class="code" bindtap="loadQrcode">【查看二维码】</text>
            </view>
        </view>
    </view>
    <view class="use-history-content-wrapper">
        <view class="nav">
            <view bindtap="changeTab" data-id="{{ item.id }}"
                  wx:for="{{ nav }}" wx:key="id"
                  class="{{ item.checked ? 'checked' : '' }}"
            >
                <block wx:if="{{ item.id === 0 }}">
                    {{ item.name }}({{ baseInfo.finishedCount }})
                </block>
                <block wx:if="{{ item.id === 1 }}">
                    {{ item.name }}({{ baseInfo.receivedCount }})
                </block>
                <block wx:if="{{ item.id === 2 }}">
                    {{ item.name }}({{ status == "3" ? '0' : baseInfo.remainCount }})
                </block>
            </view>
        </view>
        <view class="content">
            <!--完成测评开始-->
            <block wx:if="{{ checkedItem === 0 }}">
                <block wx:if="{{ baseInfo.finishedCount > 0 }}">
                    <view wx:for="{{ baseInfo.finishedUsers }}" wx:for-item="finishedItem" wx:key="unique"
                          class="content-child" data-id="{{ baseInfo.id }}" bindtap="changePage">
                        <view class="title">
                            <text>{{ finishedItem.nickname }}</text>
                            <image src="../img/user/index/icon3.png"></image>
                        </view>
                        <view class="rate">
                            <view class="rate-info">
                                <text>{{ finishedItem.report.summary.title }}</text>
                                <text>{{ finishedItem.report.total1 }}分</text>
                            </view>
                            <text>{{ util.getFullDateByFrag(finishedItem.time) }}-{{ util.getHourAndMinByFrag(finishedItem.time) }}</text>
                        </view>
                    </view>
                </block>
                <block wx:if="{{ baseInfo.finishedCount <= 0 }}">
                    <empty type="default" title="暂时没有人完成测评"></empty>
                </block>
            </block>
            <!--完成测评结束-->

            <!--作答中开始-->
            <block wx:if="{{ checkedItem === 1 }}">
                <block wx:if="{{ baseInfo.receivedCount > 0 }}">
                    <view wx:for="{{ baseInfo.receivedUsers }}" wx:for-item="receivedItem" wx:key="unique" class="content-child">
                        <view class="title">
                            <text>{{ receivedItem.nickname }}</text>
                        </view>
                        <view class="rate">
                            <view class="rate-info">
                                <text>作答开始时间：</text><text>{{ util.getFullDateByFrag(receivedItem.time) }}-{{ util.getHourAndMinByFrag(receivedItem.time) }}</text>
                            </view>
                        </view>
                    </view>
                </block>
                <block wx:if="{{ baseInfo.receivedCount <= 0 }}">
                    <empty type="default" title="暂时没有人在作答"></empty>
                </block>
            </block>
            <!--作答中结束-->

            <!--未做答开始-->
            <block wx:if="{{ checkedItem === 2 }}">
                <block wx:if="{{ baseInfo.remainCount > 0 && status != '3' }}">
<!--                    <view wx:for="{{ waitingAnswer }}" wx:key="unique" class="content-child">-->
<!--                        <view class="title">-->
<!--                            <text>{{ item.userName }}</text>-->
<!--                            <image src="../img/user/index/icon3.png"></image>-->
<!--                        </view>-->
<!--                        <view class="rate">-->
<!--                            <view class="rate-info">-->
<!--                                <text>中坚力量</text>-->
<!--                                <text>78.29分</text>-->
<!--                            </view>-->
<!--                            <text>{{ util.getFullDateByFrag(item.createdTime) }}-{{ util.getHourAndMinByFrag(item.createdTime) }}</text>-->
<!--                        </view>-->
<!--                    </view>-->
                    <empty type="scan" title="{{baseInfo.remainCount}}份测评暂未被人扫码作答" paperId="{{ baseInfo.id }}"
                           subtitle="撤回测评"></empty>
                </block>
                <block wx:elif="{{ baseInfo.remainCount > 0 && status == '3' }}">
                    <empty type="default" title="{{ baseInfo.remainCount }}份测评已全部被撤回" subtitle="测回测评"></empty>
                </block>
<!--                "{{ baseInfo.remainCount <= 0 }}"-->
                <block wx:else>
                    <empty type="default" title="测评已全部被领取了" subtitle="测回测评"></empty>
                </block>
            </block>
            <!--未做答结束-->
        </view>
    </view>
</view>
<view class="press-wrapper" bindtap="gotoDetail" data-id="{{ baseInfo.paper.id }}">
    <press title="继续发放本测评"></press>
</view>
<view class="qrcode-wrapper" wx:if="{{ imageTrigger }}">
    <view class="qrcode">
        <image class="qrcode-img" src="{{ baseInfo.img }}" bindload="imageLoad" show-menu-by-longpress="true"></image>
        <image class="close-icon" src="../img/manager/close-icon@2x.png" bindtap="closeQrcode"></image>
    </view>
    <view class="mask" bindtap="closeQrcode"></view>
</view>
<wxs src="../common/util.wxs" module="util"></wxs>
